FROM mcr.microsoft.com/dotnet/sdk:8.0 as builder

ARG POSTGRES_CONNECTION_STRING
ARG INIT_ADMIN_USERNAME
ARG INIT_ADMIN_EMAIL
ARG INIT_ADMIN_PASSWORD
ARG SECRET_KEY
ARG JWT_AUDIENCE
ARG JWT_ISSUER
ARG AWS_S3_SERVICE_URL
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG S3_BUCKET_NAME

ENV POSTGRES_CONNECTION_STRING=${POSTGRES_CONNECTION_STRING}
ENV INIT_ADMIN_USERNAME=${INIT_ADMIN_USERNAME}
ENV INIT_ADMIN_EMAIL=${INIT_ADMIN_EMAIL}
ENV INIT_ADMIN_PASSWORD=${INIT_ADMIN_PASSWORD}
ENV SECRET_KEY=${SECRET_KEY}
ENV JWT_AUDIENCE=${JWT_AUDIENCE}
ENV JWT_ISSUER=${JWT_ISSUER}
ENV AWS_S3_SERVICE_URL=${AWS_S3_SERVICE_URL}
ENV AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
ENV AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
ENV S3_BUCKET_NAME=${S3_BUCKET_NAME}

WORKDIR /app
COPY ./dotnet-voyage-log .

EXPOSE 8080
ENV ASPNETCORE_ENVIRONMENT=Development
ENTRYPOINT ["dotnet", "run", "--no-launch-profile"]